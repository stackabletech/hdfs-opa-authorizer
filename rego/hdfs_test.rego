package hdfs

import rego.v1

test_hdfs if {
    allow with input as {
        "callerUgi": {
            "shortUserName": "HTTP"
        },
        "path": "/hosts",
        "operationName": "getfileinfo",
    }
}

test_hdfs_2 if {
    allow with input as {
        "callerUgi": {
            "shortUserName": "HTTP"
        },
        "path": "/hosts",
        "operationName": "delete",
    }
}

test_hdfs_3 if {
    allow with input as {
        "callerUgi": {
            "shortUserName": "HTTP"
        },
        "path": "/",
        "operationName": "getfileinfo",
    }
}

test_hdfs_4 if {
    allow with input as {
        "callerUgi": {
            "shortUserName": "HTTP"
        },
        "path": "/ro/nested/file",
        "operationName": "getfileinfo",
    }
}

test_hdfs_5 if {
    allow with input as {
        "callerUgi": {
            "shortUserName": "HTTP"
        },
        "path": "/ro/full/file",
        "operationName": "delete",
    }
}


test_hdfs_42 if {
    allow with input as {"fsOwner":"nn","supergroup":"supergroup","callerUgi":{"realUser":null,"userName":"HTTP/simple-hdfs.default.svc.cluster.local@CLUSTER.LOCAL","shortUserName":"HTTP","primaryGroup":null,"groups":[],"authenticationMethod":"KERBEROS","realAuthenticationMethod":"KERBEROS"},"inodeAttrs":[{"parent":null,"id":16385,"modificationTime":1706605235705,"accessTime":0,"next":null,"features":[{"spaceConsumed":{"nameSpace":2,"typeSpaces":{},"storageSpace":312},"spaceAllowed":{"nameSpace":9223372036854775807,"typeSpaces":{},"storageSpace":-1}},{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646}],"directorySnapshottableFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"storagePolicyID":0,"directoryWithQuotaFeature":{"spaceConsumed":{"nameSpace":2,"typeSpaces":{},"storageSpace":312},"spaceAllowed":{"nameSpace":9223372036854775807,"typeSpaces":{},"storageSpace":-1}},"directoryWithSnapshotFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"quotaCounts":{"nameSpace":9223372036854775807,"typeSpaces":{},"storageSpace":-1},"localStoragePolicyID":0,"diffs":{"last":null,"lastSnapshotId":2147483646},"localNameBytes":"","xattrFeature":null,"groupName":"supergroup","fsPermission":{"stickyBit":false,"userAction":"ALL","groupAction":"READ_EXECUTE","otherAction":"READ_EXECUTE","masked":null,"unmasked":null,"aclBit":false,"encryptedBit":false,"erasureCodedBit":false},"aclFeature":null,"fsPermissionShort":493,"permissionLong":1099511693805,"userName":"nn","localName":"","key":"","fullPathName":"/","pathComponents":[""],"objectString":"INodeDirectory@7b92e4cd","parentString":"parent=null","parentReference":null}],"inodes":[{"parent":null,"id":16385,"modificationTime":1706605235705,"accessTime":0,"next":null,"features":[{"spaceConsumed":{"nameSpace":2,"typeSpaces":{},"storageSpace":312},"spaceAllowed":{"nameSpace":9223372036854775807,"typeSpaces":{},"storageSpace":-1}},{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646}],"directorySnapshottableFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"storagePolicyID":0,"directoryWithQuotaFeature":{"spaceConsumed":{"nameSpace":2,"typeSpaces":{},"storageSpace":312},"spaceAllowed":{"nameSpace":9223372036854775807,"typeSpaces":{},"storageSpace":-1}},"directoryWithSnapshotFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"quotaCounts":{"nameSpace":9223372036854775807,"typeSpaces":{},"storageSpace":-1},"localStoragePolicyID":0,"diffs":{"last":null,"lastSnapshotId":2147483646},"localNameBytes":"","xattrFeature":null,"groupName":"supergroup","fsPermission":{"stickyBit":false,"userAction":"ALL","groupAction":"READ_EXECUTE","otherAction":"READ_EXECUTE","masked":null,"unmasked":null,"aclBit":false,"encryptedBit":false,"erasureCodedBit":false},"aclFeature":null,"fsPermissionShort":493,"permissionLong":1099511693805,"userName":"nn","localName":"","key":"","fullPathName":"/","pathComponents":[""],"objectString":"INodeDirectory@7b92e4cd","parentString":"parent=null","parentReference":null}],"pathByNameArr":[null],"snapshotId":2147483646,"path":"/","ancestorIndex":-1,"doCheckOwner":false,"ancestorAccess":null,"parentAccess":null,"access":null,"subAccess":null,"ignoreEmptyDir":false,"operationName":"getfileinfo","callerContext":{"context":"CLI","signature":null}}
}

test_hdfs_43 if {
    allow with input as {"fsOwner":"nn","supergroup":"supergroup","callerUgi":{"realUser":null,"userName":"HTTP/simple-hdfs.default.svc.cluster.local@CLUSTER.LOCAL","shortUserName":"HTTP","primaryGroup":null,"groups":[],"authenticationMethod":"KERBEROS","realAuthenticationMethod":"KERBEROS"},"inodeAttrs":[{"parent":null,"id":16385,"modificationTime":1706605235705,"accessTime":0,"next":null,"features":[{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646}],"storagePolicyID":0,"directorySnapshottableFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"directoryWithQuotaFeature":{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},"directoryWithSnapshotFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"diffs":{"last":null,"lastSnapshotId":2147483646},"quotaCounts":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}},"localStoragePolicyID":0,"xattrFeature":null,"localNameBytes":"","fsPermissionShort":493,"permissionLong":1099511693805,"groupName":"supergroup","fsPermission":{"stickyBit":false,"userAction":"ALL","groupAction":"READ_EXECUTE","otherAction":"READ_EXECUTE","masked":null,"unmasked":null,"aclBit":false,"encryptedBit":false,"erasureCodedBit":false},"aclFeature":null,"userName":"nn","localName":"","key":"","fullPathName":"/","pathComponents":[""],"objectString":"INodeDirectory@afbccef","parentString":"parent=null","parentReference":null},null],"inodes":[{"parent":null,"id":16385,"modificationTime":1706605235705,"accessTime":0,"next":null,"features":[{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646}],"storagePolicyID":0,"directorySnapshottableFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"directoryWithQuotaFeature":{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},"directoryWithSnapshotFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"diffs":{"last":null,"lastSnapshotId":2147483646},"quotaCounts":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}},"localStoragePolicyID":0,"xattrFeature":null,"localNameBytes":"","fsPermissionShort":493,"permissionLong":1099511693805,"groupName":"supergroup","fsPermission":{"stickyBit":false,"userAction":"ALL","groupAction":"READ_EXECUTE","otherAction":"READ_EXECUTE","masked":null,"unmasked":null,"aclBit":false,"encryptedBit":false,"erasureCodedBit":false},"aclFeature":null,"userName":"nn","localName":"","key":"","fullPathName":"/","pathComponents":[""],"objectString":"INodeDirectory@afbccef","parentString":"parent=null","parentReference":null},null],"pathByNameArr":["","aG9zdHMuX0NPUFlJTkdf"],"snapshotId":2147483646,"path":"/hosts._COPYING_","ancestorIndex":0,"doCheckOwner":false,"ancestorAccess":null,"parentAccess":null,"access":null,"subAccess":null,"ignoreEmptyDir":false,"operationName":"getfileinfo","callerContext":{"context":"CLI","signature":null}}
}

test_hdfs_44 if {
    allow with input as {"fsOwner":"nn","supergroup":"supergroup","callerUgi":{"realUser":null,"userName":"HTTP/simple-hdfs.default.svc.cluster.local@CLUSTER.LOCAL","shortUserName":"HTTP","primaryGroup":null,"groups":[],"authenticationMethod":"KERBEROS","realAuthenticationMethod":"KERBEROS"},"inodeAttrs":[{"parent":null,"id":16385,"modificationTime":1706613003841,"accessTime":0,"next":null,"features":[{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646}],"directorySnapshottableFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"storagePolicyID":0,"directoryWithQuotaFeature":{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},"directoryWithSnapshotFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"quotaCounts":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}},"localStoragePolicyID":0,"diffs":{"last":null,"lastSnapshotId":2147483646},"xattrFeature":null,"localNameBytes":"","fsPermission":{"stickyBit":false,"userAction":"ALL","groupAction":"READ_EXECUTE","otherAction":"READ_EXECUTE","masked":null,"unmasked":null,"aclBit":false,"encryptedBit":false,"erasureCodedBit":false},"aclFeature":null,"fsPermissionShort":493,"permissionLong":1099511693805,"groupName":"supergroup","userName":"nn","localName":"","key":"","pathComponents":[""],"fullPathName":"/","objectString":"INodeDirectory@36873e8b","parentString":"parent=null","parentReference":null},{"parent":{"parent":null,"id":16385,"modificationTime":1706613003841,"accessTime":0,"next":null,"features":[{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646}],"directorySnapshottableFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"storagePolicyID":0,"directoryWithQuotaFeature":{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},"directoryWithSnapshotFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"quotaCounts":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}},"localStoragePolicyID":0,"diffs":{"last":null,"lastSnapshotId":2147483646},"xattrFeature":null,"localNameBytes":"","fsPermission":{"stickyBit":false,"userAction":"ALL","groupAction":"READ_EXECUTE","otherAction":"READ_EXECUTE","masked":null,"unmasked":null,"aclBit":false,"encryptedBit":false,"erasureCodedBit":false},"aclFeature":null,"fsPermissionShort":493,"permissionLong":1099511693805,"groupName":"supergroup","userName":"nn","localName":"","key":"","pathComponents":[""],"fullPathName":"/","objectString":"INodeDirectory@36873e8b","parentString":"parent=null","parentReference":null},"id":16395,"name":"/hosts._COPYING_","modificationTime":1706613004035,"accessTime":1706613003841,"next":null,"features":[],"blocks":[{"blockId":1073741833,"numBytes":312,"generationStamp":1009,"replication":1,"blockType":"CONTIGUOUS","capacity":1,"next":null,"blockUCState":"COMPLETE","underConstructionFeature":null,"blockCollectionId":16395,"storageInfos":[{"storageID":"DS-1378b0ee-edc8-452b-bf53-f5cc5e0a530a","storageType":"DISK","blockReportCount":1,"datanodeDescriptor":{"ipAddr":"172.18.0.2","ipAddrBytes":[49,55,50,46,49,56,46,48,46,50],"hostName":"simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local","hostNameBytes":[115,105,109,112,108,101,45,104,100,102,115,45,100,97,116,97,110,111,100,101,45,100,101,102,97,117,108,116,45,48,46,115,105,109,112,108,101,45,104,100,102,115,45,100,97,116,97,110,111,100,101,45,100,101,102,97,117,108,116,46,100,101,102,97,117,108,116,46,115,118,99,46,99,108,117,115,116,101,114,46,108,111,99,97,108],"peerHostName":null,"xferPort":31369,"infoPort":0,"infoSecurePort":32553,"ipcPort":30086,"xferAddr":"172.18.0.2:31369","datanodeUuid":"bc82263f-6fda-4515-a6d1-da122cfb9a41","datanodeUuidBytes":[98,99,56,50,50,54,51,102,45,54,102,100,97,45,52,53,49,53,45,97,54,100,49,45,100,97,49,50,50,99,102,98,57,97,52,49],"capacity":982141468672,"dfsUsed":49152,"nonDfsUsed":669132959744,"remaining":263042977792,"blockPoolUsed":49152,"cacheCapacity":0,"cacheUsed":0,"lastUpdate":1706613002591,"lastUpdateMonotonic":15353935,"xceiverCount":0,"softwareVersion":"3.3.6","dependentHostNames":[],"upgradeDomain":null,"numBlocks":0,"adminState":"NORMAL","maintenanceExpireTimeInMS":0,"lastBlockReportTime":1706612915593,"lastBlockReportMonotonic":15266937,"level":2,"leavingServiceStatus":{"underReplicatedBlocks":0,"outOfServiceOnlyReplicas":0,"startTime":0,"underReplicatedInOpenFiles":0,"openFiles":[]},"pendingCached":[],"cached":[],"pendingUncached":[],"lastCachingDirectiveSentTimeMs":0,"volumeFailures":0,"volumeFailureSummary":null,"balancerBandwidth":0,"blocksScheduled":0,"storageTypes":["DISK"],"numberOfBlocksToBeErasureCoded":0,"storageReports":[{"storage":{"storageID":"DS-1378b0ee-edc8-452b-bf53-f5cc5e0a530a","state":"NORMAL","storageType":"DISK"},"capacity":982141468672,"dfsUsed":49152,"nonDfsUsed":669132959744,"remaining":263042977792,"blockPoolUsed":49152}],"numberOfReplicateBlocks":0,"name":"172.18.0.2:31369","datanodeReport":"Name: 172.18.0.2:31369 (172-18-0-2.kubernetes.default.svc.cluster.local)\nHostname: simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local\nDecommission Status : Normal\nConfigured Capacity: 982141468672 (914.69 GB)\nDFS Used: 49152 (48 KB)\nNon DFS Used: 669132959744 (623.18 GB)\nDFS Remaining: 263042977792 (244.98 GB)\nDFS Used%: 0.00%\nDFS Remaining%: 26.78%\nConfigured Cache Capacity: 0 (0 B)\nCache Used: 0 (0 B)\nCache Remaining: 0 (0 B)\nCache Used%: 100.00%\nCache Remaining%: 0.00%\nXceivers: 0\nLast contact: Tue Jan 30 11:10:02 UTC 2024\nLast Block Report: Tue Jan 30 11:08:35 UTC 2024\nNum of Blocks: 0\n","networkLocation":"/default-rack","blockPoolUsedPercent":5.004574E-6,"dfsUsedPercent":5.004574E-6,"remainingPercent":26.782593,"cacheUsedPercent":100.0,"cacheRemaining":0,"cacheRemainingPercent":0.0,"infoAddr":"172.18.0.2:0","infoSecureAddr":"172.18.0.2:32553","resolvedAddress":"172.18.0.2:31369","xferAddrWithHostname":"simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local:31369"}}],"blockName":"blk_1073741833"}],"preferredBlockSize":134217728,"fileWithSnapshotFeature":null,"fileUnderConstructionFeature":null,"lastBlock":{"blockId":1073741833,"numBytes":312,"generationStamp":1009,"replication":1,"blockType":"CONTIGUOUS","capacity":1,"next":null,"blockUCState":"COMPLETE","underConstructionFeature":null,"blockCollectionId":16395,"storageInfos":[{"storageID":"DS-1378b0ee-edc8-452b-bf53-f5cc5e0a530a","storageType":"DISK","blockReportCount":1,"datanodeDescriptor":{"ipAddr":"172.18.0.2","ipAddrBytes":[49,55,50,46,49,56,46,48,46,50],"hostName":"simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local","hostNameBytes":[115,105,109,112,108,101,45,104,100,102,115,45,100,97,116,97,110,111,100,101,45,100,101,102,97,117,108,116,45,48,46,115,105,109,112,108,101,45,104,100,102,115,45,100,97,116,97,110,111,100,101,45,100,101,102,97,117,108,116,46,100,101,102,97,117,108,116,46,115,118,99,46,99,108,117,115,116,101,114,46,108,111,99,97,108],"peerHostName":null,"xferPort":31369,"infoPort":0,"infoSecurePort":32553,"ipcPort":30086,"xferAddr":"172.18.0.2:31369","datanodeUuid":"bc82263f-6fda-4515-a6d1-da122cfb9a41","datanodeUuidBytes":[98,99,56,50,50,54,51,102,45,54,102,100,97,45,52,53,49,53,45,97,54,100,49,45,100,97,49,50,50,99,102,98,57,97,52,49],"capacity":982141468672,"dfsUsed":49152,"nonDfsUsed":669132959744,"remaining":263042977792,"blockPoolUsed":49152,"cacheCapacity":0,"cacheUsed":0,"lastUpdate":1706613002591,"lastUpdateMonotonic":15353935,"xceiverCount":0,"softwareVersion":"3.3.6","dependentHostNames":[],"upgradeDomain":null,"numBlocks":0,"adminState":"NORMAL","maintenanceExpireTimeInMS":0,"lastBlockReportTime":1706612915593,"lastBlockReportMonotonic":15266937,"level":2,"leavingServiceStatus":{"underReplicatedBlocks":0,"outOfServiceOnlyReplicas":0,"startTime":0,"underReplicatedInOpenFiles":0,"openFiles":[]},"pendingCached":[],"cached":[],"pendingUncached":[],"lastCachingDirectiveSentTimeMs":0,"volumeFailures":0,"volumeFailureSummary":null,"balancerBandwidth":0,"blocksScheduled":0,"storageTypes":["DISK"],"numberOfBlocksToBeErasureCoded":0,"storageReports":[{"storage":{"storageID":"DS-1378b0ee-edc8-452b-bf53-f5cc5e0a530a","state":"NORMAL","storageType":"DISK"},"capacity":982141468672,"dfsUsed":49152,"nonDfsUsed":669132959744,"remaining":263042977792,"blockPoolUsed":49152}],"numberOfReplicateBlocks":0,"name":"172.18.0.2:31369","datanodeReport":"Name: 172.18.0.2:31369 (172-18-0-2.kubernetes.default.svc.cluster.local)\nHostname: simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local\nDecommission Status : Normal\nConfigured Capacity: 982141468672 (914.69 GB)\nDFS Used: 49152 (48 KB)\nNon DFS Used: 669132959744 (623.18 GB)\nDFS Remaining: 263042977792 (244.98 GB)\nDFS Used%: 0.00%\nDFS Remaining%: 26.78%\nConfigured Cache Capacity: 0 (0 B)\nCache Used: 0 (0 B)\nCache Remaining: 0 (0 B)\nCache Used%: 100.00%\nCache Remaining%: 0.00%\nXceivers: 0\nLast contact: Tue Jan 30 11:10:02 UTC 2024\nLast Block Report: Tue Jan 30 11:08:35 UTC 2024\nNum of Blocks: 0\n","networkLocation":"/default-rack","blockPoolUsedPercent":5.004574E-6,"dfsUsedPercent":5.004574E-6,"remainingPercent":26.782593,"cacheUsedPercent":100.0,"cacheRemaining":0,"cacheRemainingPercent":0.0,"infoAddr":"172.18.0.2:0","infoSecureAddr":"172.18.0.2:32553","resolvedAddress":"172.18.0.2:31369","xferAddrWithHostname":"simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local:31369"}}],"blockName":"blk_1073741833"},"storagePolicyID":0,"blockType":"CONTIGUOUS","localStoragePolicyID":0,"diffs":null,"fileReplication":1,"preferredBlockReplication":1,"erasureCodingPolicyID":0,"headerLong":281475110928384,"xattrFeature":null,"localNameBytes":"aG9zdHMuX0NPUFlJTkdf","fsPermission":{"stickyBit":false,"userAction":"READ_WRITE","groupAction":"READ","otherAction":"READ","masked":null,"unmasked":null,"aclBit":false,"encryptedBit":false,"erasureCodedBit":false},"aclFeature":null,"fsPermissionShort":420,"permissionLong":2199023321508,"groupName":"supergroup","userName":"HTTP","localName":"hosts._COPYING_","key":"aG9zdHMuX0NPUFlJTkdf","pathComponents":["","aG9zdHMuX0NPUFlJTkdf"],"fullPathName":"/hosts._COPYING_","quotaCounts":{"nameSpace":-1,"storageSpace":-1,"typeSpaces":{}},"objectString":"INodeFile@731e79f2","parentString":"parentDir=/","parentReference":null}],"inodes":[{"parent":null,"id":16385,"modificationTime":1706613003841,"accessTime":0,"next":null,"features":[{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646}],"directorySnapshottableFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"storagePolicyID":0,"directoryWithQuotaFeature":{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},"directoryWithSnapshotFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"quotaCounts":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}},"localStoragePolicyID":0,"diffs":{"last":null,"lastSnapshotId":2147483646},"xattrFeature":null,"localNameBytes":"","fsPermission":{"stickyBit":false,"userAction":"ALL","groupAction":"READ_EXECUTE","otherAction":"READ_EXECUTE","masked":null,"unmasked":null,"aclBit":false,"encryptedBit":false,"erasureCodedBit":false},"aclFeature":null,"fsPermissionShort":493,"permissionLong":1099511693805,"groupName":"supergroup","userName":"nn","localName":"","key":"","pathComponents":[""],"fullPathName":"/","objectString":"INodeDirectory@36873e8b","parentString":"parent=null","parentReference":null},{"parent":{"parent":null,"id":16385,"modificationTime":1706613003841,"accessTime":0,"next":null,"features":[{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646}],"directorySnapshottableFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"storagePolicyID":0,"directoryWithQuotaFeature":{"spaceConsumed":{"nameSpace":2,"storageSpace":312,"typeSpaces":{}},"spaceAllowed":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}}},"directoryWithSnapshotFeature":{"diffs":{"last":null,"lastSnapshotId":2147483646},"snapshotQuota":0,"numSnapshots":0,"snapshotList":[],"lastSnapshotId":2147483646},"quotaCounts":{"nameSpace":9223372036854775807,"storageSpace":-1,"typeSpaces":{}},"localStoragePolicyID":0,"diffs":{"last":null,"lastSnapshotId":2147483646},"xattrFeature":null,"localNameBytes":"","fsPermission":{"stickyBit":false,"userAction":"ALL","groupAction":"READ_EXECUTE","otherAction":"READ_EXECUTE","masked":null,"unmasked":null,"aclBit":false,"encryptedBit":false,"erasureCodedBit":false},"aclFeature":null,"fsPermissionShort":493,"permissionLong":1099511693805,"groupName":"supergroup","userName":"nn","localName":"","key":"","pathComponents":[""],"fullPathName":"/","objectString":"INodeDirectory@36873e8b","parentString":"parent=null","parentReference":null},"id":16395,"name":"/hosts._COPYING_","modificationTime":1706613004035,"accessTime":1706613003841,"next":null,"features":[],"blocks":[{"blockId":1073741833,"numBytes":312,"generationStamp":1009,"replication":1,"blockType":"CONTIGUOUS","capacity":1,"next":null,"blockUCState":"COMPLETE","underConstructionFeature":null,"blockCollectionId":16395,"storageInfos":[{"storageID":"DS-1378b0ee-edc8-452b-bf53-f5cc5e0a530a","storageType":"DISK","blockReportCount":1,"datanodeDescriptor":{"ipAddr":"172.18.0.2","ipAddrBytes":[49,55,50,46,49,56,46,48,46,50],"hostName":"simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local","hostNameBytes":[115,105,109,112,108,101,45,104,100,102,115,45,100,97,116,97,110,111,100,101,45,100,101,102,97,117,108,116,45,48,46,115,105,109,112,108,101,45,104,100,102,115,45,100,97,116,97,110,111,100,101,45,100,101,102,97,117,108,116,46,100,101,102,97,117,108,116,46,115,118,99,46,99,108,117,115,116,101,114,46,108,111,99,97,108],"peerHostName":null,"xferPort":31369,"infoPort":0,"infoSecurePort":32553,"ipcPort":30086,"xferAddr":"172.18.0.2:31369","datanodeUuid":"bc82263f-6fda-4515-a6d1-da122cfb9a41","datanodeUuidBytes":[98,99,56,50,50,54,51,102,45,54,102,100,97,45,52,53,49,53,45,97,54,100,49,45,100,97,49,50,50,99,102,98,57,97,52,49],"capacity":982141468672,"dfsUsed":49152,"nonDfsUsed":669132959744,"remaining":263042977792,"blockPoolUsed":49152,"cacheCapacity":0,"cacheUsed":0,"lastUpdate":1706613002591,"lastUpdateMonotonic":15353935,"xceiverCount":0,"softwareVersion":"3.3.6","dependentHostNames":[],"upgradeDomain":null,"numBlocks":0,"adminState":"NORMAL","maintenanceExpireTimeInMS":0,"lastBlockReportTime":1706612915593,"lastBlockReportMonotonic":15266937,"level":2,"leavingServiceStatus":{"underReplicatedBlocks":0,"outOfServiceOnlyReplicas":0,"startTime":0,"underReplicatedInOpenFiles":0,"openFiles":[]},"pendingCached":[],"cached":[],"pendingUncached":[],"lastCachingDirectiveSentTimeMs":0,"volumeFailures":0,"volumeFailureSummary":null,"balancerBandwidth":0,"blocksScheduled":0,"storageTypes":["DISK"],"numberOfBlocksToBeErasureCoded":0,"storageReports":[{"storage":{"storageID":"DS-1378b0ee-edc8-452b-bf53-f5cc5e0a530a","state":"NORMAL","storageType":"DISK"},"capacity":982141468672,"dfsUsed":49152,"nonDfsUsed":669132959744,"remaining":263042977792,"blockPoolUsed":49152}],"numberOfReplicateBlocks":0,"name":"172.18.0.2:31369","datanodeReport":"Name: 172.18.0.2:31369 (172-18-0-2.kubernetes.default.svc.cluster.local)\nHostname: simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local\nDecommission Status : Normal\nConfigured Capacity: 982141468672 (914.69 GB)\nDFS Used: 49152 (48 KB)\nNon DFS Used: 669132959744 (623.18 GB)\nDFS Remaining: 263042977792 (244.98 GB)\nDFS Used%: 0.00%\nDFS Remaining%: 26.78%\nConfigured Cache Capacity: 0 (0 B)\nCache Used: 0 (0 B)\nCache Remaining: 0 (0 B)\nCache Used%: 100.00%\nCache Remaining%: 0.00%\nXceivers: 0\nLast contact: Tue Jan 30 11:10:02 UTC 2024\nLast Block Report: Tue Jan 30 11:08:35 UTC 2024\nNum of Blocks: 0\n","networkLocation":"/default-rack","blockPoolUsedPercent":5.004574E-6,"dfsUsedPercent":5.004574E-6,"remainingPercent":26.782593,"cacheUsedPercent":100.0,"cacheRemaining":0,"cacheRemainingPercent":0.0,"infoAddr":"172.18.0.2:0","infoSecureAddr":"172.18.0.2:32553","resolvedAddress":"172.18.0.2:31369","xferAddrWithHostname":"simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local:31369"}}],"blockName":"blk_1073741833"}],"preferredBlockSize":134217728,"fileWithSnapshotFeature":null,"fileUnderConstructionFeature":null,"lastBlock":{"blockId":1073741833,"numBytes":312,"generationStamp":1009,"replication":1,"blockType":"CONTIGUOUS","capacity":1,"next":null,"blockUCState":"COMPLETE","underConstructionFeature":null,"blockCollectionId":16395,"storageInfos":[{"storageID":"DS-1378b0ee-edc8-452b-bf53-f5cc5e0a530a","storageType":"DISK","blockReportCount":1,"datanodeDescriptor":{"ipAddr":"172.18.0.2","ipAddrBytes":[49,55,50,46,49,56,46,48,46,50],"hostName":"simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local","hostNameBytes":[115,105,109,112,108,101,45,104,100,102,115,45,100,97,116,97,110,111,100,101,45,100,101,102,97,117,108,116,45,48,46,115,105,109,112,108,101,45,104,100,102,115,45,100,97,116,97,110,111,100,101,45,100,101,102,97,117,108,116,46,100,101,102,97,117,108,116,46,115,118,99,46,99,108,117,115,116,101,114,46,108,111,99,97,108],"peerHostName":null,"xferPort":31369,"infoPort":0,"infoSecurePort":32553,"ipcPort":30086,"xferAddr":"172.18.0.2:31369","datanodeUuid":"bc82263f-6fda-4515-a6d1-da122cfb9a41","datanodeUuidBytes":[98,99,56,50,50,54,51,102,45,54,102,100,97,45,52,53,49,53,45,97,54,100,49,45,100,97,49,50,50,99,102,98,57,97,52,49],"capacity":982141468672,"dfsUsed":49152,"nonDfsUsed":669132959744,"remaining":263042977792,"blockPoolUsed":49152,"cacheCapacity":0,"cacheUsed":0,"lastUpdate":1706613002591,"lastUpdateMonotonic":15353935,"xceiverCount":0,"softwareVersion":"3.3.6","dependentHostNames":[],"upgradeDomain":null,"numBlocks":0,"adminState":"NORMAL","maintenanceExpireTimeInMS":0,"lastBlockReportTime":1706612915593,"lastBlockReportMonotonic":15266937,"level":2,"leavingServiceStatus":{"underReplicatedBlocks":0,"outOfServiceOnlyReplicas":0,"startTime":0,"underReplicatedInOpenFiles":0,"openFiles":[]},"pendingCached":[],"cached":[],"pendingUncached":[],"lastCachingDirectiveSentTimeMs":0,"volumeFailures":0,"volumeFailureSummary":null,"balancerBandwidth":0,"blocksScheduled":0,"storageTypes":["DISK"],"numberOfBlocksToBeErasureCoded":0,"storageReports":[{"storage":{"storageID":"DS-1378b0ee-edc8-452b-bf53-f5cc5e0a530a","state":"NORMAL","storageType":"DISK"},"capacity":982141468672,"dfsUsed":49152,"nonDfsUsed":669132959744,"remaining":263042977792,"blockPoolUsed":49152}],"numberOfReplicateBlocks":0,"name":"172.18.0.2:31369","datanodeReport":"Name: 172.18.0.2:31369 (172-18-0-2.kubernetes.default.svc.cluster.local)\nHostname: simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local\nDecommission Status : Normal\nConfigured Capacity: 982141468672 (914.69 GB)\nDFS Used: 49152 (48 KB)\nNon DFS Used: 669132959744 (623.18 GB)\nDFS Remaining: 263042977792 (244.98 GB)\nDFS Used%: 0.00%\nDFS Remaining%: 26.78%\nConfigured Cache Capacity: 0 (0 B)\nCache Used: 0 (0 B)\nCache Remaining: 0 (0 B)\nCache Used%: 100.00%\nCache Remaining%: 0.00%\nXceivers: 0\nLast contact: Tue Jan 30 11:10:02 UTC 2024\nLast Block Report: Tue Jan 30 11:08:35 UTC 2024\nNum of Blocks: 0\n","networkLocation":"/default-rack","blockPoolUsedPercent":5.004574E-6,"dfsUsedPercent":5.004574E-6,"remainingPercent":26.782593,"cacheUsedPercent":100.0,"cacheRemaining":0,"cacheRemainingPercent":0.0,"infoAddr":"172.18.0.2:0","infoSecureAddr":"172.18.0.2:32553","resolvedAddress":"172.18.0.2:31369","xferAddrWithHostname":"simple-hdfs-datanode-default-0.simple-hdfs-datanode-default.default.svc.cluster.local:31369"}}],"blockName":"blk_1073741833"},"storagePolicyID":0,"blockType":"CONTIGUOUS","localStoragePolicyID":0,"diffs":null,"fileReplication":1,"preferredBlockReplication":1,"erasureCodingPolicyID":0,"headerLong":281475110928384,"xattrFeature":null,"localNameBytes":"aG9zdHMuX0NPUFlJTkdf","fsPermission":{"stickyBit":false,"userAction":"READ_WRITE","groupAction":"READ","otherAction":"READ","masked":null,"unmasked":null,"aclBit":false,"encryptedBit":false,"erasureCodedBit":false},"aclFeature":null,"fsPermissionShort":420,"permissionLong":2199023321508,"groupName":"supergroup","userName":"HTTP","localName":"hosts._COPYING_","key":"aG9zdHMuX0NPUFlJTkdf","pathComponents":["","aG9zdHMuX0NPUFlJTkdf"],"fullPathName":"/hosts._COPYING_","quotaCounts":{"nameSpace":-1,"storageSpace":-1,"typeSpaces":{}},"objectString":"INodeFile@731e79f2","parentString":"parentDir=/","parentReference":null}],"pathByNameArr":["","aG9zdHMuX0NPUFlJTkdf"],"snapshotId":2147483646,"path":"/hosts._COPYING_","ancestorIndex":0,"doCheckOwner":false,"ancestorAccess":null,"parentAccess":"WRITE","access":null,"subAccess":"ALL","ignoreEmptyDir":true,"operationName":"delete","callerContext":{"context":"CLI","signature":null}}
}

test_hdfs_45 if {
    allow with input as {
        "callerUgi": {
            "shortUserName": "HTTP"
        },
        "path": "/hosts._COPYING_",
        "operationName": "delete",
    }
}
